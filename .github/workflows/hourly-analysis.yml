name: ðŸš€ AAPL Options Analyzer - Hourly Automated

on:
  schedule:
    # Run every hour from 11 AM to 4 PM EST (15:00 to 20:00 UTC)
    # Saturday testing: runs every hour for 7 hours total
    - cron: '0 15-20 * * 6'  # Saturday only (for testing)
    - cron: '0 14-21 * * 1-5'  # Monday-Friday 9 AM - 4 PM EST (13:00-21:00 UTC)
  
  # Allow manual trigger for testing
  workflow_dispatch:
    inputs:
      test_mode:
        description: 'Run in test mode'
        required: false
        default: 'true'

jobs:
  options-analysis:
    runs-on: ubuntu-latest
    timeout-minutes: 3  # Hard limit: 3 minutes max per run
    
    steps:
    - name: ðŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ðŸ Set up Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip'
        
    - name: ðŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: â° Show Current Time
      run: |
        echo "ðŸ• UTC Time: $(date -u)"
        echo "ðŸ• EST Time: $(TZ='America/New_York' date)"
        echo "ðŸ“… Day of week: $(date +%A)"
        
    - name: ðŸš€ Run AAPL Options Analysis (2 min max)
      timeout-minutes: 2
      run: |
        echo "ðŸš€ Starting 2-minute AAPL analysis burst..."
        echo "ðŸ’° Resource optimization: 2 min/hour = 14 min/day total"
        echo "ðŸ“Š Target: AAPL put options with mobile notifications"
        
        # Create config for notifications
        cat > config.py << 'EOF'
        NOTIFICATION_CONFIG = {
            'ntfy': {
                'enabled': True,
                'topic': 'options_price',
                'base_url': 'https://ntfy.sh'
            }
        }
        EOF
        
        # Run the optimized GitHub Actions runner
        python3 github_runner.py
        
    - name: ðŸ“Š Resource Usage Summary
      if: always()
      run: |
        echo "ðŸ“Š === RESOURCE USAGE SUMMARY ==="
        echo "â° Runtime: ~2 minutes (maximum)"
        echo "ðŸ”„ Frequency: Every hour during market hours"
        echo "ðŸ“… Daily usage: ~14 minutes (7 runs Ã— 2 min)"
        echo "ðŸ“ˆ Monthly projection: ~7 hours (vs 210 hours continuous)"
        echo "ðŸ’° Resource savings: 96.7% efficiency gain"
        echo "ðŸŽ¯ Next run: In 1 hour"
        echo "=================================="
