name: 🚀 Multi-Stock Options Analyzer - Hourly Automated

on:
  schedule:
    # Weekend testing: Saturday/Sunday 10 AM - 6 PM EST (14:00 to 22:00 UTC)
    - cron: '0 14-22 * * 6,0'  # Saturday and Sunday 
    # Monday-Friday: 9 AM - 4 PM EST (13:00-21:00 UTC) 
    - cron: '0 13-21 * * 1-5'  # Monday-Friday regular market hours
    # Extra testing: Every 2 hours for more frequent updates
    - cron: '0 */2 * * *'  # Every 2 hours daily for testing
  
  # Allow manual trigger for testing
  workflow_dispatch:
    inputs:
      test_mode:
        description: 'Run in test mode'
        required: false
        default: 'true'

jobs:
  options-analysis:
    runs-on: ubuntu-latest
    timeout-minutes: 15  # Extended for multi-stock analysis with 3-min delays
    
    steps:
    - name: 📥 Checkout Repository
      uses: actions/checkout@v4
      
    - name: 🐍 Set up Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip'
        
    - name: 📦 Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: ⏰ Show Current Time
      run: |
        echo "🕐 UTC Time: $(date -u)"
        echo "🕐 EST Time: $(TZ='America/New_York' date)"
        echo "📅 Day of week: $(date +%A)"
        echo "🎯 UPDATED: Weekend testing 10 AM - 6 PM EST"
        echo "📊 Weekday testing: 9 AM - 4 PM EST"
        
    - name: 🚀 Run Multi-Stock Options Analysis (15 min max)
      timeout-minutes: 15
      run: |
        echo "🚀 Starting 15-minute multi-stock analysis..."
        echo "� Analyzing: AAPL, NVDA, GOOG, GOOGL"
        echo "⏱️ Notifications: 3 minutes apart per stock"
        echo "� Total time: ~12 minutes (analysis + notifications)"
        
        # Create config for notifications
        cat > config.py << 'EOF'
        NOTIFICATION_CONFIG = {
            'ntfy': {
                'enabled': True,
                'topic': 'options_price',
                'base_url': 'https://ntfy.sh'
            }
        }
        EOF
        
        # Run the optimized GitHub Actions runner
        python3 github_runner.py
        
    - name: 📊 Resource Usage Summary
      if: always()
      run: |
        echo "📊 === RESOURCE USAGE SUMMARY ==="
        echo "⏰ Runtime: ~2 minutes (maximum)"
        echo "🔄 Frequency: Every hour during market hours"
        echo "📅 Daily usage: ~14 minutes (7 runs × 2 min)"
        echo "📈 Monthly projection: ~7 hours (vs 210 hours continuous)"
        echo "💰 Resource savings: 96.7% efficiency gain"
        echo "🎯 Next run: In 1 hour"
        echo "=================================="
